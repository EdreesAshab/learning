<table
  mat-table
  [dataSource]="dataSource"
  matSort
  class="mat-elevation-z8"
  (matSortChange)="sortData($event)"
>
  <!-- Radio button column -->

  <ng-container matColumnDef="radio">
    <th mat-header-cell *matHeaderCellDef></th>
    <td
      mat-cell
      *matCellDef="let row"
      [ngClass]="{ selectedLeftSurvey: isSelected(row.SRV_ID) }"
    >
      <mat-radio-button
        [checked]="isSelected(row.SRV_ID)"
        (click)="selectSurvey(row)"
      ></mat-radio-button>
    </td>
  </ng-container>

  <!-- SurveyName Column -->
  <ng-container matColumnDef="surveyName">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Survey Name</th>
    <td
      mat-cell
      *matCellDef="let row"
      [ngClass]="{ selectedSurvey: isSelected(row.SRV_ID) }"
    >
      <mat-icon
        [fontIcon]="'check'"
        style="color: #02ca98"
        *ngIf="row.SURVEY_STATUS_EN === 'Published'"
      ></mat-icon>

      <mat-icon
        [fontIcon]="'alarm'"
        style="color: #8d8d8d"
        *ngIf="row.SURVEY_STATUS_EN === 'Expired'"
      ></mat-icon>

      <mat-icon
        [fontIcon]="'lock'"
        style="color: #8d8d8d"
        *ngIf="row.SURVEY_STATUS_EN === 'Closed'"
      ></mat-icon>

      {{ row.SurveyName }}
    </td>
  </ng-container>

  <!-- From Column -->
  <ng-container matColumnDef="from">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>From</th>
    <td
      mat-cell
      *matCellDef="let row"
      [ngClass]="{ selectedSurvey: isSelected(row.SRV_ID) }"
    >
      <p *ngIf="row.SelectedPeriod">
        {{ getStartDateString(row.SelectedPeriod) }}
      </p>

      <p *ngIf="row.SurveyPeriods && !checkIfNotOneDate(row.SurveyPeriods)">
        {{ getStartDateString(row.SurveyPeriods) }}
      </p>
    </td>
  </ng-container>

  <!-- To Column -->
  <ng-container matColumnDef="to">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>To</th>
    <td
      mat-cell
      *matCellDef="let row"
      [ngClass]="{ selectedSurvey: isSelected(row.SRV_ID) }"
    >
      <p *ngIf="row.SelectedPeriod">
        {{ getEndDateString(row.SelectedPeriod) }}
      </p>

      <p *ngIf="row.SurveyPeriods && !checkIfNotOneDate(row.SurveyPeriods)">
        {{ getEndDateString(row.SurveyPeriods) }}
      </p>
    </td>
  </ng-container>

  <!-- Period Column -->
  <ng-container matColumnDef="period">
    <th mat-header-cell *matHeaderCellDef>Period</th>
    <td
      mat-cell
      *matCellDef="let row"
      [ngClass]="{ selectedRightSurvey: isSelected(row.SRV_ID) }"
    >
      <mat-form-field
        *ngIf="row.SurveyPeriods && checkIfNotOneDate(row.SurveyPeriods)"
      >
        <mat-label>Select Period</mat-label>
        <mat-select (selectionChange)="changePeriod($event.value, row)">
          @for (period of getParsedPeriods(row.SurveyPeriods); track $index) {
          <mat-option [value]="period"
            >{{ getStartDateString(period).replaceAll("-", "/") }}
            -
            {{ getEndDateString(period).replaceAll("-", "/") }}</mat-option
          >
          }
        </mat-select>
      </mat-form-field>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr
    mat-row
    *matRowDef="let row; columns: displayedColumns"
    [ngClass]="{ selectedSurvey: isSelected(row.SRV_ID) }"
  ></tr>
</table>
